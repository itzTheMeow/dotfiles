[global]
use-profiles = ["default"]

[repository]
repository = "/opt/pcloud/Misc/Backups/ipad"
password-command = "opunattended op://Private/7kaur74rgd5da4kfcabgy3ahb4/password"

[backup]
host = "ipad"
glob-files = ["/opt/rustic/default.glob", "/opt/rustic/ipad.glob"]
#TODO:set-xattrs = "false"

[[backup.snapshots]]
sources = ["/mnt/ipad"]
as-path = "/"

[backup.hooks]
run-before = [
  # ensure directory exists
  { command = "mkdir", args = [
    "-p",
    "/mnt/ipad",
  ] },
  # mount rclone
  { command = "rclone", args = [
    "mount",
    "ipad:/",
    "/mnt/ipad",
    "--daemon",
    "--read-only",
    "--transfers",
    "12",
  ] },
]
run-finally = [
  # unmount rclone
  { command = "fusermount", args = ["-u", "/mnt/ipad"] },
]
